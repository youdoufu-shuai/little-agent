<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人智能代理</title>
    <link rel="stylesheet" href="style.css?v=1.6">
    <script src="marked.min.js"></script>
</head>
<body>
    <!-- Ambient Background -->
    <div class="ambient-glow glow-1"></div>
    <div class="ambient-glow glow-2"></div>

    <!-- SVG Icons Definitions -->
    <svg style="display: none;">
        <symbol id="icon-user" viewBox="0 0 448 512">
            <path fill="currentColor" d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z"/>
        </symbol>
        <symbol id="icon-chat" viewBox="0 0 512 512">
            <path fill="currentColor" d="M448 0H64C28.7 0 0 28.7 0 64v288c0 35.3 28.7 64 64 64h96v84c0 9.8 11.2 15.5 19.1 9.7L304 416h144c35.3 0 64-28.7 64-64V64c0-35.3-28.7-64-64-64z"/>
        </symbol>
        <symbol id="icon-trash" viewBox="0 0 448 512">
            <path fill="currentColor" d="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z"/>
        </symbol>
        <symbol id="icon-plus" viewBox="0 0 448 512">
            <path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"/>
        </symbol>
        <symbol id="icon-user-gear" viewBox="0 0 640 512">
            <path fill="currentColor" d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H322.8c-3.1-8.8-3.7-18.4-1.4-27.8l15-60.1c2.8-11.3 8.6-21.5 16.8-29.7l40.3-40.3c-32.1-31-75.7-50.1-123.9-50.1H178.3zm435.5-68.3c-15.6-15.6-40.9-15.6-56.6 0l-29.4 29.4 71 71 29.4-29.4c15.6-15.6 15.6-40.9 0-56.6l-14.4-14.4zM375.9 417c-4.1 4.1-7 9.2-8.4 14.9l-15 60.1c-1.4 5.5 .2 11.2 4.2 15.2s9.7 5.6 15.2 4.2l60.1-15c5.6-1.4 10.8-4.3 14.9-8.4L476.1 459l-71-71L375.9 417z"/>
        </symbol>
        <symbol id="icon-database" viewBox="0 0 448 512">
            <path fill="currentColor" d="M448 80v48c0 44.2-100.3 80-224 80S0 172.2 0 128V80C0 35.8 100.3 0 224 0S448 35.8 448 80zM393.2 214.7c20.8-7.4 39.9-16.9 54.8-28.6V288c0 44.2-100.3 80-224 80S0 332.2 0 288V186.1c14.9 11.8 34 21.2 54.8 28.6C99.7 230.7 159.5 240 224 240s124.3-9.3 169.2-25.3zM0 346.1c14.9 11.8 34 21.2 54.8 28.6C99.7 390.7 159.5 400 224 400s124.3-9.3 169.2-25.3c20.8-7.4 39.9-16.9 54.8-28.6V432c0 44.2-100.3 80-224 80S0 476.2 0 432V346.1z"/>
        </symbol>
        <symbol id="icon-brain" viewBox="0 0 512 512">
            <path fill="currentColor" d="M184 0c30.9 0 56 25.1 56 56V456c0 30.9-25.1 56-56 56c-28.9 0-52.7-21.9-55.7-50.1c-5.2 1.4-10.7 2.1-16.3 2.1c-35.3 0-64-28.7-64-64c0-7.4 1.3-14.6 3.6-21.2C21.4 367.4 0 338.2 0 304c0-31.9 18.7-59.5 45.8-72.3C37.1 220.8 32 207 32 192c0-30.7 21.6-56.3 50.4-62.6C88 123.9 92 118 92 112c0-26.5 21.5-48 48-48c6.9 0 13.4 1.5 19.4 4.1C163 26.2 173.1 0 184 0zM328 0c10.9 0 21 26.2 24.6 68.1c6-2.7 12.6-4.1 19.4-4.1c26.5 0 48 21.5 48 48c0 6-4 11.9-9.6 17.4c28.8 6.3 50.4 31.9 50.4 62.6c0 15-5.1 28.8-13.8 39.7C493.3 244.5 512 272.1 512 304c0 34.2-21.4 63.4-51.6 74.8c2.3 6.6 3.6 13.8 3.6 21.2c0 35.3-28.7 64-64 64c-5.6 0-11.1-.7-16.3-2.1c-3 28.2-26.8 50.1-55.7 50.1c-30.9 0-56-25.1-56-56V56c0-30.9 25.1-56 56-56z"/>
        </symbol>
        <symbol id="icon-eye" viewBox="0 0 576 512">
            <path fill="currentColor" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"/>
        </symbol>
        <symbol id="icon-sun" viewBox="0 0 512 512">
            <path fill="currentColor" d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 14.8l-72.2 95.2 72.1 95.2c3.1 4.1 3.7 9.7 1.6 14.8s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-14.8-1.6l-95.2-72.2-95.2 72.2c-4.1 3.1-9.7 3.7-14.8 1.6s-8.6-6.6-9.6-11.9L112 391 4.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-14.8l72.2-95.2L13.9 156.3c-3.1-4.1-3.7-9.7-1.6-14.8s6.6-8.6 11.9-9.6L132 112 151.9 4.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 14.8 1.6l95.2 72.2 95.2-72.2c4.1-3.1 9.7-3.7 14.8-1.6zM252 256c0 39.8-32.2 72-72 72s-72-32.2-72-72s32.2-72 72-72s72 32.2 72 72z"/>
        </symbol>
        <symbol id="icon-moon" viewBox="0 0 384 512">
            <path fill="currentColor" d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4 5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6-96.9 0-175.5-78.8-175.5-176 0-65.8 36-123.1 89.3-153.3 6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"/>
        </symbol>
        <symbol id="icon-paperclip" viewBox="0 0 448 512">
            <path fill="currentColor" d="M364.2 83.8c-24.4-24.4-64-24.4-88.4 0l-184 184c-42.1 42.1-42.1 110.3 0 152.4s110.3 42.1 152.4 0l152-152c10.9-10.9 28.7-10.9 39.6 0s10.9 28.7 0 39.6l-152 152c-64 64-167.6 64-231.6 0s-64-167.6 0-231.6l184-184c46.3-46.3 121.3-46.3 167.6 0s46.3 121.3 0 167.6l-176 176c-28.6 28.6-75 28.6-103.6 0s-28.6-75 0-103.6l144-144c10.9-10.9 28.7-10.9 39.6 0s10.9 28.7 0 39.6l-144 144c-6.7 6.7-6.7 17.7 0 24.4s17.7 6.7 24.4 0l176-176c24.4-24.4 24.4-64 0-88.4z"/>
        </symbol>
        <symbol id="icon-paper-plane" viewBox="0 0 512 512">
            <path fill="currentColor" d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480V396.4c0-4 1.5-7.8 4.2-10.7l167.6-182.9c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z"/>
        </symbol>
        <symbol id="icon-stop" viewBox="0 0 384 512">
            <path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H320c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V128z"/>
        </symbol>
        <symbol id="icon-cog" viewBox="0 0 512 512">
            <path fill="currentColor" d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336a80 80 0 1 0 0-160 80 80 0 1 0 0 160z"/>
        </symbol>
        <symbol id="icon-sync" viewBox="0 0 512 512">
            <path fill="currentColor" d="M463.5 224H472c13.3 0 24-10.7 24-24V72c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8H463.5z"/>
        </symbol>
        <symbol id="icon-copy" viewBox="0 0 448 512">
            <path fill="currentColor" d="M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V192c0-35.3 28.7-64 64-64zm336 64h32a32 32 0 0 1 32 32v32H384V192zm-32-32V32a32 32 0 0 0 -32-32H208a32 32 0 0 0 -32 32V336a32 32 0 0 0 32 32H400a32 32 0 0 0 32-32V160H352z"/>
        </symbol>
        <symbol id="icon-mic" viewBox="0 0 384 512">
            <path fill="currentColor" d="M192 0C139 0 96 43 96 96V256c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H216V430.4c85.8-11.7 152-85.3 152-174.4V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 70.7-57.3 128-128 128s-128-57.3-128-128V216z"/>
        </symbol>
        <symbol id="icon-volume-high" viewBox="0 0 576 512">
            <path fill="currentColor" d="M301.1 34.8C312.6 40 320 51.4 320 64V448c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h67.8L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3zM425 167l55 55 55-55c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-55 55 55 55c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-55-55-55 55c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l55-55-55-55c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"/>
        </symbol>
        <symbol id="icon-volume-mute" viewBox="0 0 576 512">
            <path fill="currentColor" d="M301.1 34.8C312.6 40 320 51.4 320 64V448c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h67.8L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3zM416 256c0-53 43-96 96-96c13.3 0 24 10.7 24 24s-10.7 24-24 24c-26.5 0-48 21.5-48 48s21.5 48 48 48c13.3 0 24 10.7 24 24s-10.7 24-24 24c-53 0-96-43-96-96z"/>
        </symbol>
    </svg>

    <!-- Splash Screen -->
    <div id="splash-screen">
        <div class="splash-content">
            <div class="logo-wrapper">
                <div class="logo-ring"></div>
                <img src="static/images/logo_dark_mode.png" alt="Way Agent Logo" class="splash-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/4712/4712035.png'">
            </div>
            <h1 class="splash-title">Way Agent</h1>
            <div class="loading-bar-container">
                <div class="loading-bar"></div>
            </div>
            <div class="loading-text">Initializing Neural Core...</div>
        </div>
    </div>

    <div class="sidebar">
        <div class="brand">
            <img id="sidebar-logo" src="static/images/logo_dark_mode.png" alt="Way Agent" class="brand-logo">
            <span id="agent-name-display">智能助理 Way</span>
        </div>
        
        <div class="sidebar-actions">
             <button id="new-chat-btn" class="action-btn primary">
                <svg class="icon"><use href="#icon-plus"></use></svg> 新建对话
             </button>
             <button id="personas-btn" class="action-btn">
                <svg class="icon"><use href="#icon-user-gear"></use></svg> 人设管理
             </button>
             <button id="db-viewer-btn" class="action-btn">
                <svg class="icon"><use href="#icon-database"></use></svg> 数据库管理
             </button>
             <button id="settings-btn" class="action-btn">
                <svg class="icon"><use href="#icon-cog"></use></svg> 设置
             </button>
        </div>

        <div class="history-container">
            <div class="history-label">历史记录</div>
            <div class="history-list" id="history-list">
                <!-- History Items will be loaded here -->
            </div>
        </div>
        
        <div class="status-panel">
            <div class="status-item">
                <div class="status-dot"></div>
                <span>系统在线</span>
            </div>
            
            <div style="margin-top: 30px;">
                <div class="status-item">
                    <svg class="icon" style="color: var(--accent-dim); margin-right: 10px;"><use href="#icon-brain"></use></svg>
                    <span>逻辑核心</span>
                </div>
                <div class="model-info">Gemini Flash Thinking</div>
            </div>

            <div style="margin-top: 20px;">
                <div class="status-item">
                    <svg class="icon" style="color: var(--accent-dim); margin-right: 10px;"><use href="#icon-eye"></use></svg>
                    <span>视觉核心</span>
                </div>
                <div class="model-info">Gemini 3 Pro</div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <!-- Theme Toggle Button -->
        <button class="theme-toggle" id="theme-btn" title="切换主题">
            <svg class="icon"><use href="#icon-sun"></use></svg>
        </button>

        <!-- Chat Area -->
        <div class="chat-container" id="chat-container">
            <!-- Messages will appear here -->
        </div>

        <!-- Input Area -->

        <div class="input-area">
            <img id="image-preview" class="image-preview" alt="上传预览" style="display: none;">
            <div id="file-preview" class="file-preview" style="display: none;"></div>
            <div class="input-wrapper">
                <input type="file" id="image-upload" accept="image/*,.pdf,.doc,.docx,.txt,.md,.py,.js,.html,.css,.json" style="display: none;">
                <button class="icon-btn" onclick="document.getElementById('image-upload').click()" title="上传文件">
                    <svg class="icon"><use href="#icon-paperclip"></use></svg>
                </button>
                <textarea id="user-input" placeholder="输入指令或问题... (Ctrl+Enter 发送)" rows="1"></textarea>
                
                <!-- Voice Input Button -->
                <button class="icon-btn" id="mic-btn" title="语音输入" style="margin-right: 5px;">
                    <svg class="icon"><use href="#icon-mic"></use></svg>
                </button>

                <span id="execution-timer" style="display: none; font-family: monospace; font-size: 0.85rem; color: var(--accent-color); margin-right: 10px; align-self: center;">00:00</span>

                <button class="icon-btn" id="stop-btn" title="停止生成" style="display: none; color: #ff4444; margin-right: 5px;">
                    <svg class="icon"><use href="#icon-stop"></use></svg>
                </button>

                <button class="icon-btn" id="send-btn" title="发送">
                    <svg class="icon"><use href="#icon-paper-plane"></use></svg>
                </button>
            </div>
        </div>
    </div>

    <div id="db-modal" class="modal" style="display: none;"></div>

    <!-- Personas Modal -->
    <div id="personas-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal">&times;</span>
            <h2><svg class="icon"><use href="#icon-user-gear"></use></svg> 人设管理</h2>
            
            <div id="personas-list" style="margin-bottom: 20px; max-height: 200px; overflow-y: auto;">
                <!-- Persona Items -->
            </div>

            <button id="add-persona-btn" class="action-btn" style="margin-bottom: 15px; border-style: dashed;">
                <svg class="icon"><use href="#icon-plus"></use></svg> 添加新人设
            </button>

            <div id="persona-form" style="display: none; border-top: 1px solid var(--border-color); padding-top: 15px;">
                <h3 style="margin-bottom: 10px; font-size: 1rem;">编辑人设</h3>
                <div class="form-group">
                    <label>名称</label>
                    <input type="text" id="persona-name" placeholder="例如：Python专家">
                </div>
                <div class="form-group">
                    <label>描述</label>
                    <input type="text" id="persona-desc" placeholder="简短描述">
                </div>
                <div class="form-group">
                    <label>系统提示词 (System Prompt)</label>
                    <textarea id="persona-prompt" rows="5" style="width: 100%; padding: 10px; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 5px; font-family: var(--font-mono);"></textarea>
                </div>
                <button id="save-persona-btn" class="primary-btn">保存人设</button>
                <button id="cancel-persona-btn" class="action-btn" style="margin-top: 5px; border: none; color: #888;">取消</button>
            </div>
        </div>
    </div>

    <!-- DB Viewer Modal -->
    <div id="db-viewer-modal" class="modal">
        <div class="modal-content" style="max-width: 900px; height: 90vh; display: flex; flex-direction: column;">
            <span class="close-modal">&times;</span>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;"><svg class="icon"><use href="#icon-database"></use></svg> 数据库管理</h2>
                <button id="toggle-db-config" class="action-btn" style="font-size: 0.8rem;"><svg class="icon"><use href="#icon-cog"></use></svg> 连接配置</button>
            </div>

            <!-- Config Panel (Collapsible) -->
            <div id="db-config-panel" style="display: none; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                <div style="display: grid; grid-template-columns: 2fr 1fr 2fr 2fr; gap: 10px;">
                    <div class="form-group" style="margin:0;">
                        <label style="font-size: 0.8rem;">Host</label>
                        <input type="text" id="db-host" placeholder="localhost" value="localhost" style="padding: 5px;">
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label style="font-size: 0.8rem;">Port</label>
                        <input type="number" id="db-port" placeholder="3306" value="3306" style="padding: 5px;">
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label style="font-size: 0.8rem;">User</label>
                        <input type="text" id="db-user" placeholder="root" style="padding: 5px;">
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label style="font-size: 0.8rem;">Password</label>
                        <input type="password" id="db-password" placeholder="password" style="padding: 5px;">
                    </div>
                </div>
                <div style="display: flex; justify-content: flex-end; margin-top: 10px; gap: 10px;">
                     <button id="test-connection-btn" class="action-btn" style="width: auto; padding: 5px 20px;">测试连接</button>
                     <button id="save-connect-db-btn" class="primary-btn" style="width: auto; padding: 5px 20px;">保存并连接</button>
                </div>
            </div>
            
            <div style="display: flex; gap: 20px; flex: 1; overflow: hidden;">
                <!-- Left Sidebar: Databases & Tables -->
                <div style="width: 250px; border-right: 1px solid var(--border-color); padding-right: 10px; overflow-y: auto; display: flex; flex-direction: column;">
                    
                    <!-- Database Selection -->
                    <div style="margin-bottom: 15px;">
                        <h3 style="font-size: 0.9rem; color: var(--accent-dim); margin-bottom: 5px;">数据库</h3>
                        <div style="display: flex; gap: 5px;">
                            <select id="db-select" style="flex: 1; padding: 5px; background: var(--input-bg); color: var(--text-color); border: 1px solid var(--border-color); border-radius: 4px;">
                                <option value="">未连接</option>
                            </select>
                            <button id="refresh-dbs-btn" class="icon-btn" title="刷新数据库列表"><svg class="icon"><use href="#icon-sync"></use></svg></button>
                        </div>
                    </div>

                    <!-- Tables List -->
                    <h3 style="font-size: 0.9rem; color: var(--accent-dim); margin-bottom: 10px;">数据表</h3>
                    <div id="tables-list" style="flex: 1; overflow-y: auto;">
                        <div style="padding: 10px; color: #888; font-size: 0.8rem;">请先连接数据库</div>
                    </div>
                </div>
                
                <!-- Data View -->
                <div style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                    <h3 id="current-table-name" style="font-size: 0.9rem; color: var(--accent-dim); margin-bottom: 10px;">数据预览</h3>
                    <div id="table-data-container" style="flex: 1; overflow: auto; background: rgba(0,0,0,0.2); border-radius: 5px;">
                        <!-- Table Data -->
                        <div style="padding: 20px; color: #888;">请选择左侧表以查看数据</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-modal">&times;</span>
            <h2><svg class="icon"><use href="#icon-cog"></use></svg> 代理设置</h2>
            
            <h3 style="margin-top: 20px; font-size: 1.1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;">文件读取权限</h3>
            
            <div style="margin-top: 15px; display: flex; align-items: center; justify-content: space-between;">
                <label style="font-weight: 500;">允许读取本地文件</label>
                <label class="switch" style="position: relative; display: inline-block; width: 40px; height: 24px;">
                    <input type="checkbox" id="allow-read-toggle" checked>
                    <span class="slider round" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>

            <!-- Voice Settings -->
            <h3 style="margin-top: 20px; font-size: 1.1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;">语音交互</h3>
            <div style="margin-top: 15px; display: flex; align-items: center; justify-content: space-between;">
                <label style="font-weight: 500;">自动朗读回复 (TTS)</label>
                <label class="switch" style="position: relative; display: inline-block; width: 40px; height: 24px;">
                    <input type="checkbox" id="auto-tts-toggle">
                    <span class="slider round" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; transition: .4s; border-radius: 24px;"></span>
                </label>
            </div>
            
            <style>
                /* Switch Slider CSS */
                .switch input { opacity: 0; width: 0; height: 0; }
                .slider { background-color: #ccc; }
                .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
                input:checked + .slider { background-color: var(--accent-color); }
                input:focus + .slider { box-shadow: 0 0 1px var(--accent-color); }
                input:checked + .slider:before { transform: translateX(16px); }
            </style>
            
            <h3 style="margin-top: 20px; font-size: 1.1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;">AI API 配置</h3>
            <div class="form-group" style="margin-top: 10px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500;">Base URL</label>
                <input type="text" id="api-base-url" placeholder="https://api.openai.com/v1" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-color);">
            </div>
            <div class="form-group" style="margin-top: 10px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500;">API Key</label>
                <input type="password" id="api-key" placeholder="sk-..." style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-color);">
            </div>
            <div class="form-group" style="margin-top: 10px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 500;">Model</label>
                <input type="text" id="api-model" placeholder="例如: gemini-1.5-pro" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-color);">
            </div>

            <h3 style="margin-top: 20px; font-size: 1.1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;">路径白名单</h3>
            <p style="font-size: 0.8rem; color: #888; margin-top: 5px;">允许代理访问的绝对路径列表 (每行一个)</p>
            <textarea id="whitelist-paths" rows="4" placeholder="/Users/username/project" style="width: 100%; margin-top: 10px; padding: 8px; border-radius: 5px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-color); font-family: monospace;"></textarea>

            <div style="margin-top: 20px; text-align: right;">
                <button id="save-settings-btn" class="primary-btn">保存设置</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=1.8"></script>
</body>
</html>
